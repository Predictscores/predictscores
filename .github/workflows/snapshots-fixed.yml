name: Snapshots (AM/PM/LATE)

on:
  schedule:
    # UTC -> SRB: 22:00 -> 00:00 (LATE), 08:00 -> 10:00 (AM), 13:00 -> 15:00 (PM)
    - cron: '0 22 * * *'
    - cron: '0 8 * * *'
    - cron: '0 13 * * *'
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - name: LATE/AM/PM snapshot pipeline
        run: |
          set -euo pipefail
          BASE="https://predictscores.vercel.app"
          echo "[1/5] Rebuild..."
          curl -fsS "$BASE/api/cron/rebuild"
          echo "[2/5] Refresh odds..."
          curl -fsS "$BASE/api/cron/refresh-odds"
          echo "[3/5] Insights build..."
          curl -fsS "$BASE/api/cron/insights-build"
          echo "[4/5] Apply learning..."
          curl -fsS "$BASE/api/cron/apply-learning"
          echo "[5/5] History settle (3d)..."
          curl -fsS "$BASE/api/history-check?days=3"
          echo "Done."
