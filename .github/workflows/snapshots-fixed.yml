name: Snapshots (AM/PM/LATE)

on:
  schedule:
    # UTC -> SRB: 22:00 -> 00:00 (LATE), 08:00 -> 10:00 (AM), 13:00 -> 15:00 (PM)
    - cron: '0 22 * * *'
    - cron: '0 8 * * *'
    - cron: '0 13 * * *'
  workflow_dispatch:

jobs:
  run-late:
    runs-on: ubuntu-latest
    steps:
      - name: Rebuild (LATE slot)
        run: |
          set -euo pipefail
          BASE="https://predictscores.vercel.app"
          curl -fsS "$BASE/api/cron/rebuild?slot=late"
      - name: Refresh odds (window)
        run: |
          set -euo pipefail
          BASE="https://predictscores.vercel.app"
          curl -fsS "$BASE/api/cron/refresh-odds"
      - name: Insights build
        run: |
          set -euo pipefail
          BASE="https://predictscores.vercel.app"
          curl -fsS "$BASE/api/cron/insights-build"
      - name: Apply learning (writes :last)
        run: |
          set -euo pipefail
          BASE="https://predictscores.vercel.app"
          curl -fsS "$BASE/api/cron/apply-learning"
      - name: History settle (3 days)
        run: |
          set -euo pipefail
          BASE="https://predictscores.vercel.app"
          curl -fsS "$BASE/api/history-check?days=3"

  run-am:
    runs-on: ubuntu-latest
    steps:
      - name: Rebuild (AM slot)
        run: |
          set -euo pipefail
          BASE="https://predictscores.vercel.app"
          curl -fsS "$BASE/api/cron/rebuild?slot=am"
      - name: Refresh odds (window)
        run: |
          set -euo pipefail
          BASE="https://predictscores.vercel.app"
          curl -fsS "$BASE/api/cron/refresh-odds"
      - name: Insights build
        run: |
          set -euo pipefail
          BASE="https://predictscores.vercel.app"
          curl -fsS "$BASE/api/cron/insights-build"
      - name: Apply learning (writes :last)
        run: |
          set -euo pipefail
          BASE="https://predictscores.vercel.app"
          curl -fsS "$BASE/api/cron/apply-learning"
      - name: History settle (3 days)
        run: |
          set -euo pipefail
          BASE="https://predictscores.vercel.app"
          curl -fsS "$BASE/api/history-check?days=3"

  run-pm:
    runs-on: ubuntu-latest
    steps:
      - name: Rebuild (PM slot)
        run: |
          set -euo pipefail
          BASE="https://predictscores.vercel.app"
          curl -fsS "$BASE/api/cron/rebuild?slot=pm"
      - name: Refresh odds (window)
        run: |
          set -euo pipefail
          BASE="https://predictscores.vercel.app"
          curl -fsS "$BASE/api/cron/refresh-odds"
      - name: Insights build
        run: |
          set -euo pipefail
          BASE="https://predictscores.vercel.app"
          curl -fsS "$BASE/api/cron/insights-build"
      - name: Apply learning (writes :last)
        run: |
          set -euo pipefail
          BASE="https://predictscores.vercel.app"
          curl -fsS "$BASE/api/cron/apply-learning"
      - name: History settle (3 days)
        run: |
          set -euo pipefail
          BASE="https://predictscores.vercel.app"
          curl -fsS "$BASE/api/history-check?days=3"
