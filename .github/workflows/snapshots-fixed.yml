      - name: Resolve BASE, SLOT and YMD (Europe/Belgrade)
        id: ctx
        env:
          FALLBACK_BASE: https://predictscores.vercel.app
          INP: ${{ inputs.slot }}
          SCH: ${{ github.event.schedule }}
        run: |
          set -euo pipefail

          BASE="${BASE:-$FALLBACK_BASE}"
          echo "base=$BASE" >> $GITHUB_OUTPUT

          # 1) Ručni ulaz ima prioritet
          if [ -n "${INP:-}" ] && [ "${INP}" != "auto" ]; then
            SLOT="$INP"
          # 2) Ako smo stvarno na schedule eventu, mapiraj po cron izrazu
          elif [ -n "${SCH:-}" ]; then
            case "$SCH" in
              "0 8 * * *")  SLOT="am"  ;;  # 10:00 SRB
              "0 13 * * *") SLOT="pm"  ;;  # 15:00 SRB
              "0 22 * * *") SLOT="late";;  # 00:00 SRB (prethodni UTC dan)
              *)            SLOT="am"  ;;
            esac
          # 3) Fallback: izračunaj slot po SRB lokalnom satu
          else
            H=$(TZ=Europe/Belgrade date +%H)
            if   [ "$H" -lt 10 ]; then SLOT="late"
            elif [ "$H" -lt 15 ]; then SLOT="am"
            else SLOT="pm"
            fi
          fi

          echo "slot=$SLOT" >> $GITHUB_OUTPUT
          echo "ymd=$(TZ=Europe/Belgrade date +%F)" >> $GITHUB_OUTPUT
